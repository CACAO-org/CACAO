<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>cacao: Function Parameter Structure (FPS)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="cacao-logo-small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">cacao
   &#160;<span id="projectnumber">Release 0.1.03-dev</span>
   </div>
   <div id="projectbrief">Compute And Control For Adaptive Optics</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('page_FunctionParameterStructure.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Function Parameter Structure (FPS) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#page_FunctionParameterStructure_Overview">1. Overview and background</a></li>
<li class="level1"><a href="#page_FunctionParameterStructure_UserInterface">2. FPS user interface</a><ul><li class="level2"><a href="#page_FunctionParameterStructure_WritingFPSCMDscripts">2.1. Building command scripts from a `fpslist.txt` file</a></li>
<li class="level2"><a href="#page_FunctionParameterStructure_fpsCTRL">2.2. fpsCTRL tool</a></li>
</ul>
</li>
<li class="level1"><a href="#page_FunctionParameterStructure_WritingCLIfunc">3. Writing the CLI function (in &lt;module&gt;.c file)</a></li>
<li class="level1"><a href="#page_FunctionParameterStructure_WritingPrototypes">4. Writing function prototypes (in &lt;module&gt;.h)</a></li>
<li class="level1"><a href="#page_FunctionParameterStructure_WritingCONFfunc">5. Writing CONF function (in source .c file)</a></li>
<li class="level1"><a href="#page_FunctionParameterStructure_WritingRUNfunc">6. Writing RUN function (in source .c file)</a><ul><li class="level2"><a href="#page_FunctionParameterStructure_WritingRUNfunc_simple">6.1. A simple _RUN example</a></li>
<li class="level2"><a href="#page_FunctionParameterStructure_WritingRUNfunc_processinfo">6.3. RUN function with FPS and processinfo</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><dl class="section note"><dt>Note</dt><dd>This file: ./src/CommandLineInterface/doc/FunctionParameterStructure.md</dd></dl>
<hr/>
<p><b>The function parameter structure (FPS) exposes a function's internal variables for read and/or write. It is stored in shared memory, in /tmp/&lt;fpsname&gt;.fps.shm.</b></p>
<p>Steps to run FPS-enabled processes: </p><pre class="fragment">$ vim fpslist.txt               # Edit file, listing functions and corresponding FPS names that will be used
$ fpsmkcmd                      # create FPS scripts in `./fpscmd/`
$ ./fpscmd/fpsinitscript        # create FPS shared memory structure(s)
$ ./fpscmd/fpsconfstartscript   # start FPS configuration process(es)
$ fpsCTRL -m _ALL               # FPS control tool, scan ALL FPSs (-m: force match with fpscmd/fpslist.txt)
Type 'P' to im(P)ort configuration
</pre><hr/>
<h1><a class="anchor" id="page_FunctionParameterStructure_Overview"></a>
1. Overview and background</h1>
<h2>1.1. Main elements</h2>
<p>FPS-enabled functions have the following elements:</p><ul>
<li>The shared memory FPS: /tmp/&lt;fpsname&gt;.fps.shm</li>
<li>A configuration process that manages the FPS entries</li>
<li>A run process (the function itself)</li>
</ul>
<h2>1.2. FPS name</h2>
<p>&lt;fpsname&gt; consists of a root name (string), and a series of optional integers. Note that the number of digits matters and is part of the name: </p><pre class="fragment">&lt;fpsname&gt; = &lt;fpsnameroot&gt;.&lt;opt0&gt;.&lt;opt1&gt;...
</pre><p>Examples: </p><pre class="fragment">myfps                        # simple name, no optional integers
myfps-000000                 # optional integer 000000
myfps-000043-000020-000002   # 3 optional integers
</pre><dl class="section warning"><dt>Warning</dt><dd>The FPS name does not need to match the process or function name. FPS name is specified in the CLI function as described in <a class="el" href="page_FunctionParameterStructure.html#page_FunctionParameterStructure_WritingCLIfunc"><ol type="1">
<li>Writing the CLI function (in &lt;module&gt;.c file)</li>
</ol>
</a>.</dd></dl>
<h2>1.3. FPS-related entities</h2>
<table class="doxtable">
<tr>
<th>name </th><th>Type </th><th>Description </th><th>Origin  </th></tr>
<tr>
<td>/tmp/&lt;fpsname&gt;.fps.shm </td><td>shared memory </td><td>FP structure </td><td>Created by FPS init function </td></tr>
<tr>
<td>./fpscmd/&lt;fpsnameroot&gt;-confinit </td><td>script </td><td>Initialize FPS </td><td>Built by fpsmkcmd, can be user-edited </td></tr>
<tr>
<td>./fpscmd/&lt;fpsnameroot&gt;-confstart </td><td>script </td><td>Start CONF process </td><td>Built by fpsmkcmd, can be user-edited </td></tr>
<tr>
<td>./fpscmd/&lt;fpsnameroot&gt;-runstart </td><td>script </td><td>Start RUN process </td><td>Built by fpsmkcmd, can be user-edited </td></tr>
<tr>
<td>./fpscmd/&lt;fpsnameroot&gt;-runstop </td><td>script </td><td>Stop RUN process </td><td>Built by fpsmkcmd, can be user-edited </td></tr>
<tr>
<td>&lt;fpsname&gt;-conf </td><td>tmux session </td><td>where CONF runs </td><td>Set up by fpsCTRL </td></tr>
<tr>
<td>&lt;fpsname&gt;-run </td><td>tmux session </td><td>where RUN runs </td><td>Set up by fpsCTRL </td></tr>
<tr>
<td>./fpsconf/&lt;fpsname&gt;/... </td><td>ASCII file </td><td>parameter value </td><td>&lt;TBD&gt; </td></tr>
</table>
<hr/>
<h1><a class="anchor" id="page_FunctionParameterStructure_UserInterface"></a>
2. FPS user interface</h1>
<p>Main steps to enable FPS-enabled function for fpsCTRL:</p>
<ul>
<li>Add entry in ./fpslist.txt</li>
<li>Run milk-fpsmkcmd</li>
<li>Run ./fpscmd/&lt;fpsname&gt;-confinit</li>
</ul>
<p>These steps should ideally performed by a setup script.</p>
<h2><a class="anchor" id="page_FunctionParameterStructure_WritingFPSCMDscripts"></a>
2.1. Building command scripts from a `fpslist.txt` file</h2>
<p>The user-provided <code>fpslist.txt</code> file lists the functions and corresponding FPS names that will be in use:</p>
<div class="fragment"><div class="line"># List of FPS-enabled function</div><div class="line"># Column 1: root name used to name FPS</div><div class="line"># Column 2: CLI command</div><div class="line"># Column(s) 3+: optional arguments, integers, 6 digits</div><div class="line"></div><div class="line">fpsrootname0    CLIcommand0</div><div class="line">fpsrootname1    CLIcommand1     optarg00    optarg01</div></div><!-- fragment --><p>FPS command scripts are built by </p><pre class="fragment">$ fpsmkcmd
</pre><p>The command will create the FPS command scripts in directory <code>./fpscmd/</code>, which are then called by the <a class="el" href="page_FunctionParameterStructure.html#page_FunctionParameterStructure_fpsCTRL">2.2. fpsCTRL tool</a> to control the CONF and RUN processes.</p>
<h2><a class="anchor" id="page_FunctionParameterStructure_fpsCTRL"></a>
2.2. fpsCTRL tool</h2>
<p>The FPS control tool is started from the command line : </p><pre class="fragment">$ fpsCTRL
</pre><hr/>
<h1><a class="anchor" id="page_FunctionParameterStructure_WritingCLIfunc"></a>
3. Writing the CLI function (in &lt;module&gt;.c file)</h1>
<p>A single CLI function, named &lt;functionname&gt;_cli, will take the following arguments:</p><ul>
<li>arg1: A command code</li>
<li>arg2+: Optional arguments</li>
</ul>
<p>The command code is a string, and will determine the action to be executed:</p><ul>
<li><code>_FPSINIT_</code> : Initialize FPS for the function</li>
<li><code>_CONFSTART_</code> : Start the FPS configuration process</li>
<li><code>_CONFSTOP_</code> : Stop the FPS configuration process</li>
<li><code>_RUNSTART_</code> : Start the run process</li>
<li><code>_RUNSTOP_</code> : Stop the run process</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Why Optional arguments to CLI function ? </dd>
<dd>
Multiple instances of a C function may need to be running, each with its own FPS. Optional arguments provides a mechanism to differentiate the FPSs. They are appended to the FPS name following a dash. Optional arguments can be a number (usually integer) or a string.</dd></dl>
<p>Example source code below.</p>
<div class="fragment"><div class="line"><a class="code" href="AOloopControl__IOtools_8h.html#a46a037236862ac1a534efbe605c10f42">errno_t</a> ExampleFunction_cli()</div><div class="line">{</div><div class="line">    <span class="comment">// try FPS implementation</span></div><div class="line">    <span class="comment">// set data.fpsname, providing default value as first arg, and set data.FPS_CMDCODE value</span></div><div class="line">    <span class="comment">// default FPS name will be used if CLI process has NOT been named</span></div><div class="line">    <span class="comment">// see code in function_parameter.c for detailed rules</span></div><div class="line">    <a class="code" href="function__parameters_8c.html#ae08ea43e607b4b66e8fc21ae4ee5f37a">function_parameter_getFPSname_from_CLIfunc</a>(<span class="stringliteral">&quot;measlinRM&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>(<a class="code" href="AOloopControl__predfilter__onoff_8c.html#a9842752e03b4de9b4593f1a3b34364ab">data</a>.<a class="code" href="structDATA.html#aa72da2e9598039ec8a7310d05b81fa98">FPS_CMDCODE</a> != 0) { <span class="comment">// use FPS implementation   </span></div><div class="line">        <span class="comment">// set pointers to CONF and RUN functions</span></div><div class="line">        <a class="code" href="AOloopControl__predfilter__onoff_8c.html#a9842752e03b4de9b4593f1a3b34364ab">data</a>.<a class="code" href="structDATA.html#ad6fa88bbb61f5485213edd9fd6bf58f9">FPS_CONFfunc</a> = ExampleFunction_FPCONF;</div><div class="line">        <a class="code" href="AOloopControl__predfilter__onoff_8c.html#a9842752e03b4de9b4593f1a3b34364ab">data</a>.<a class="code" href="structDATA.html#a64b7b04b56aac63d3bfbf2a8ad21f8ed">FPS_RUNfunc</a>  = ExampleFunction_RUN;</div><div class="line">        <a class="code" href="function__parameters_8c.html#a93d950bf9afa9269d500b89473965122">function_parameter_execFPScmd</a>();</div><div class="line">        <span class="keywordflow">return</span> <a class="code" href="CLIcore_8h.html#a9d37d43ac2717b06ef7120784465e56f">RETURN_SUCCESS</a>;</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// call non FPS implementation - all parameters specified at function launch</span></div><div class="line">    <span class="keywordflow">if</span>(</div><div class="line">        <a class="code" href="CLIcore_8c.html#acfa3a12412c06fe66437c5f77f066fa0">CLI_checkarg</a>(1, 1) +</div><div class="line">        <a class="code" href="CLIcore_8c.html#acfa3a12412c06fe66437c5f77f066fa0">CLI_checkarg</a>(2, 2) </div><div class="line">        == 0) {</div><div class="line">        ExampleFunction(</div><div class="line">            <a class="code" href="AOloopControl__predfilter__onoff_8c.html#a9842752e03b4de9b4593f1a3b34364ab">data</a>.<a class="code" href="structDATA.html#a1072fcd97dbe8660a3b3d7d54b21b300">cmdargtoken</a>[1].<a class="code" href="structCMDARGTOKEN.html#a96839ddcbefc8d1629d9be94a1319bc3">val</a>.<a class="code" href="structCMDARGTOKEN.html#a8f29c19d721dbe26248fc92c01c0e497">numf</a>,</div><div class="line">            <a class="code" href="AOloopControl__predfilter__onoff_8c.html#a9842752e03b4de9b4593f1a3b34364ab">data</a>.<a class="code" href="structDATA.html#a1072fcd97dbe8660a3b3d7d54b21b300">cmdargtoken</a>[2].<a class="code" href="structCMDARGTOKEN.html#a96839ddcbefc8d1629d9be94a1319bc3">val</a>.<a class="code" href="structCMDARGTOKEN.html#a8ef8bd8dde032f117c7c316dee08a7c9">numl</a></div><div class="line">        );</div><div class="line"></div><div class="line">        <span class="keywordflow">return</span> <a class="code" href="CLIcore_8h.html#a9d37d43ac2717b06ef7120784465e56f">RETURN_SUCCESS</a>;</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">        <span class="keywordflow">return</span> <a class="code" href="CLIcore_8h.html#aa17b04e6fe0dfeaa114f866b7989f71e">CLICMD_INVALID_ARG</a>;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><hr/>
<h1><a class="anchor" id="page_FunctionParameterStructure_WritingPrototypes"></a>
4. Writing function prototypes (in &lt;module&gt;.h)</h1>
<div class="fragment"><div class="line"><a class="code" href="AOloopControl__IOtools_8h.html#a46a037236862ac1a534efbe605c10f42">errno_t</a> ExampleFunction_FPCONF();</div><div class="line"><a class="code" href="AOloopControl__IOtools_8h.html#a46a037236862ac1a534efbe605c10f42">errno_t</a> ExampleFunction_RUN();</div><div class="line"><a class="code" href="AOloopControl__IOtools_8h.html#a46a037236862ac1a534efbe605c10f42">errno_t</a> ExampleFunction(<span class="keywordtype">long</span> arg0num, <span class="keywordtype">long</span> arg1num, <span class="keywordtype">long</span> arg2num, <span class="keywordtype">long</span> arg3num);</div></div><!-- fragment --><hr/>
<h1><a class="anchor" id="page_FunctionParameterStructure_WritingCONFfunc"></a>
5. Writing CONF function (in source .c file)</h1>
<p>Check <a class="el" href="function__parameters_8h.html" title="Tools to help expose and control function parameters. ">function_parameters.h</a> for full list of flags.</p>
<div class="fragment"><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// manages configuration parameters</span></div><div class="line"><span class="comment">// initializes configuration parameters structure</span></div><div class="line"><span class="comment">//</span></div><div class="line"><a class="code" href="AOloopControl__IOtools_8h.html#a46a037236862ac1a534efbe605c10f42">errno_t</a> ExampleFunction_FPCONF(</div><div class="line">)</div><div class="line">{</div><div class="line">    <span class="comment">// ===========================</span></div><div class="line">    <span class="comment">// SETUP FPS</span></div><div class="line">    <span class="comment">// ===========================</span></div><div class="line">    <a class="code" href="group__fpsmacro.html#gade74dae399d86f7240287f5255bc13f3">FPS_SETUP_INIT</a>(<a class="code" href="AOloopControl__predfilter__onoff_8c.html#a9842752e03b4de9b4593f1a3b34364ab">data</a>.<a class="code" href="structDATA.html#a96e498dc9093cb773f2717d14d899de8">FPS_name</a>, <a class="code" href="AOloopControl__predfilter__onoff_8c.html#a9842752e03b4de9b4593f1a3b34364ab">data</a>.FPS_CMDMODE); <span class="comment">// macro in function_parameter.h</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// ==============================================</span></div><div class="line">    <span class="comment">// ========= ALLOCATE FPS ENTRIES ===============</span></div><div class="line">    <span class="comment">// ==============================================</span></div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> *pNull = NULL;</div><div class="line">    uint64_t FPFLAG;</div><div class="line"></div><div class="line">    <span class="comment">// Entries are added one by one with function_parameter_add_entry()</span></div><div class="line">    <span class="comment">// For each entry, we record the function parameter index (fpi_) returned by the function so that parameters can conveniently be accesses in the &quot;LOGIC&quot; section</span></div><div class="line">    <span class="comment">// Arguments:</span></div><div class="line">    <span class="comment">//   - pointer to fps</span></div><div class="line">    <span class="comment">//   - parameter path for GUI</span></div><div class="line">    <span class="comment">//   - description</span></div><div class="line">    <span class="comment">//   - type</span></div><div class="line">    <span class="comment">//   - flags</span></div><div class="line">    <span class="comment">//   - initialization pointer. If pNull, then the variable is not initialized</span></div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="comment">// Check CommandLineInterface/function_parameters.h for full list of flags.</span></div><div class="line"></div><div class="line">    <span class="keywordtype">long</span> fpi_param01 = <a class="code" href="function__parameters_8c.html#ab5fd7ed4766f82b5d24504f5e8b8ebb3">function_parameter_add_entry</a>(&amp;fps, <span class="stringliteral">&quot;.param01&quot;</span>, <span class="stringliteral">&quot;First parameter&quot;</span>,</div><div class="line">                       <a class="code" href="function__parameters_8h.html#a530731d930088a77377438a3786856ef">FPTYPE_INT64</a>, <a class="code" href="function__parameters_8h.html#a757212015413dc7ddd3cab75d0614995">FPFLAG_DEFAULT_INPUT</a>, pNull);</div><div class="line"></div><div class="line">    <span class="comment">// This parameter will be intitialized to a value of 5, min-max range from 0 to 10, and current value 5</span></div><div class="line">    int64_t param02default[4] = { 5, 0, 10, 5 };</div><div class="line">    FPFLAG = <a class="code" href="function__parameters_8h.html#a757212015413dc7ddd3cab75d0614995">FPFLAG_DEFAULT_INPUT</a> | <a class="code" href="function__parameters_8h.html#aa967894d1d8346b755dced8ce9882c09">FPFLAG_MINLIMIT</a> | <a class="code" href="function__parameters_8h.html#af5d4d9e1afd274d531c80bc828f12c86">FPFLAG_MAXLIMIT</a>;  <span class="comment">// required to enforce the min and max limits</span></div><div class="line">    FPFLAG &amp;= ~<a class="code" href="function__parameters_8h.html#aca96159d1e1641a1a8a0d32dbb0f48c8">FPFLAG_WRITECONF</a>;  <span class="comment">// Don&#39;t allow parameter to be written during configuration</span></div><div class="line">    FPFLAG &amp;= ~<a class="code" href="function__parameters_8h.html#a667307630284d2f4ba8daea9e890b32f">FPFLAG_WRITERUN</a>;   <span class="comment">// Don&#39;t allow parameter to be written during run</span></div><div class="line">    <span class="keywordtype">long</span> fpi_param02 = <a class="code" href="function__parameters_8c.html#ab5fd7ed4766f82b5d24504f5e8b8ebb3">function_parameter_add_entry</a>(&amp;fps, <span class="stringliteral">&quot;.param02&quot;</span>, <span class="stringliteral">&quot;Second parameter&quot;</span>,</div><div class="line">                       <a class="code" href="function__parameters_8h.html#a530731d930088a77377438a3786856ef">FPTYPE_INT64</a>, FPFLAG, &amp;param02default);</div><div class="line"></div><div class="line">    <span class="comment">// if parameter type = FPTYPE_FLOAT32, make sure default is declared as float[4]</span></div><div class="line">    <span class="comment">// if parameter type = FPTYPE_FLOAT64, make sure default is declared as double[4]</span></div><div class="line">    <span class="keywordtype">float</span> gaindefault[4] = { 0.01, 0.0, 1.0, 0.01 };</div><div class="line">    FPFLAG = <a class="code" href="function__parameters_8h.html#a757212015413dc7ddd3cab75d0614995">FPFLAG_DEFAULT_INPUT</a> | <a class="code" href="function__parameters_8h.html#aa967894d1d8346b755dced8ce9882c09">FPFLAG_MINLIMIT</a> | <a class="code" href="function__parameters_8h.html#af5d4d9e1afd274d531c80bc828f12c86">FPFLAG_MAXLIMIT</a>;  <span class="comment">// required to enforce the min and max limits</span></div><div class="line">    <span class="keywordtype">long</span> fpi_gain = <a class="code" href="function__parameters_8c.html#ab5fd7ed4766f82b5d24504f5e8b8ebb3">function_parameter_add_entry</a>(&amp;fps, <span class="stringliteral">&quot;.gain&quot;</span>, <span class="stringliteral">&quot;gain value&quot;</span>,</div><div class="line">                    <a class="code" href="function__parameters_8h.html#a7292f450a947ea0c2558b17873637d7f">FPTYPE_FLOAT32</a>, FPFLAG, &amp;gaindefault);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// This parameter is a ON / OFF toggle</span></div><div class="line">    <span class="keywordtype">long</span> fpi_gainset = <a class="code" href="function__parameters_8c.html#ab5fd7ed4766f82b5d24504f5e8b8ebb3">function_parameter_add_entry</a>(&amp;fps, <span class="stringliteral">&quot;.option.gainwrite&quot;</span>, <span class="stringliteral">&quot;gain can be changed&quot;</span>,</div><div class="line">                       <a class="code" href="function__parameters_8h.html#a34ac8110e3dea86f4d0a7d9bf4b8bcd3">FPTYPE_ONOFF</a>, <a class="code" href="function__parameters_8h.html#a757212015413dc7ddd3cab75d0614995">FPFLAG_DEFAULT_INPUT</a>, pNull);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// stream that needs to be loaded on startup</span></div><div class="line">    FPFLAG = <a class="code" href="function__parameters_8h.html#a01fbddaf935745c97f1ac08635514a22">FPFLAG_DEFAULT_INPUT_STREAM</a>;</div><div class="line">    <span class="keywordtype">long</span> fpi_streamname_wfs       = <a class="code" href="function__parameters_8c.html#ab5fd7ed4766f82b5d24504f5e8b8ebb3">function_parameter_add_entry</a>(&amp;fps, <span class="stringliteral">&quot;.sn_wfs&quot;</span>,  <span class="stringliteral">&quot;WFS stream name&quot;</span>,</div><div class="line">                                    <a class="code" href="function__parameters_8h.html#a52d9a3fa97b8a430d50cf08fee4977f6">FPTYPE_STREAMNAME</a>, FPFLAG, pNull);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// Output file name</span></div><div class="line">    <span class="keywordtype">long</span> fpi_filename_out1          = <a class="code" href="function__parameters_8c.html#ab5fd7ed4766f82b5d24504f5e8b8ebb3">function_parameter_add_entry</a>(&amp;fps, <span class="stringliteral">&quot;.out.fname_out1&quot;</span>, <span class="stringliteral">&quot;output file 1&quot;</span>,</div><div class="line">                                      <a class="code" href="function__parameters_8h.html#a5f96a2233967f28ec30947affab09ade">FPTYPE_FILENAME</a>, <a class="code" href="function__parameters_8h.html#af3e497e04e50b31782b95c3a6b264985">FPFLAG_DEFAULT_OUTPUT</a>, pNull);</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// Macros examples</span></div><div class="line">    <span class="comment">// see function_parameters.h</span></div><div class="line"></div><div class="line">    <a class="code" href="group__fpsmacro.html#gac6d3282c5b39252ecf2ffe2a0491dea7">FPS_ADDPARAM_STREAM_IN</a>  (stream_inname,        <span class="stringliteral">&quot;.in_name&quot;</span>,     <span class="stringliteral">&quot;input stream&quot;</span>);</div><div class="line">    <a class="code" href="group__fpsmacro.html#ga120eaf4f3272629185c5e872b83a6653">FPS_ADDPARAM_STREAM_OUT</a> (stream_outname,       <span class="stringliteral">&quot;.out_name&quot;</span>,    <span class="stringliteral">&quot;output stream&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordtype">long</span> timeavemode_default[4] = { 0, 0, 3, 0 };</div><div class="line">    <a class="code" href="group__fpsmacro.html#gaab206dfb7e0f3a20b61014d25b020ea5">FPS_ADDPARAM_INT64_IN</a>  (</div><div class="line">        option_timeavemode,</div><div class="line">        <span class="stringliteral">&quot;.option.timeavemode&quot;</span>,</div><div class="line">        <span class="stringliteral">&quot;Enable time window averaging (&gt;0)&quot;</span>,</div><div class="line">        &amp;timeavemode_default);</div><div class="line"></div><div class="line">    <span class="keywordtype">double</span> avedt_default[4] = { 0.001, 0.0001, 1.0, 0.001};</div><div class="line">    <a class="code" href="group__fpsmacro.html#ga56c1fc50f8614a995f6d7ef3b1dd5c97">FPS_ADDPARAM_FLT64_IN</a>  (</div><div class="line">        option_avedt,</div><div class="line">        <span class="stringliteral">&quot;.option.avedt&quot;</span>,</div><div class="line">        <span class="stringliteral">&quot;Averaging time window width&quot;</span>,</div><div class="line">        &amp;avedt_default);</div><div class="line"></div><div class="line">    <span class="comment">// status</span></div><div class="line">    <a class="code" href="group__fpsmacro.html#ga2117a2acad5b9adc43a00893af4181cc">FPS_ADDPARAM_INT64_OUT</a> (zsize,        <span class="stringliteral">&quot;.status.zsize&quot;</span>,     <span class="stringliteral">&quot;cube size&quot;</span>);</div><div class="line">    <a class="code" href="group__fpsmacro.html#ga2117a2acad5b9adc43a00893af4181cc">FPS_ADDPARAM_INT64_OUT</a> (framelog,     <span class="stringliteral">&quot;.status.framelag&quot;</span>,  <span class="stringliteral">&quot;lag in frame unit&quot;</span>);</div><div class="line">    <a class="code" href="group__fpsmacro.html#ga2117a2acad5b9adc43a00893af4181cc">FPS_ADDPARAM_INT64_OUT</a> (kkin,         <span class="stringliteral">&quot;.status.kkin&quot;</span>,      <span class="stringliteral">&quot;input cube slice index&quot;</span>);</div><div class="line">    <a class="code" href="group__fpsmacro.html#ga2117a2acad5b9adc43a00893af4181cc">FPS_ADDPARAM_INT64_OUT</a> (kkout,        <span class="stringliteral">&quot;.status.kkout&quot;</span>,     <span class="stringliteral">&quot;output cube slice index&quot;</span>);</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// ==============================================</span></div><div class="line">    <span class="comment">// ======== START FPS CONF LOOP =================</span></div><div class="line">    <span class="comment">// ==============================================</span></div><div class="line">    <a class="code" href="group__fpsmacro.html#gae70fe94849793f147fdd38b35fd5d413">FPS_CONFLOOP_START</a>  <span class="comment">// macro in function_parameter.h</span></div><div class="line"></div><div class="line">    <span class="comment">// here goes the logic</span></div><div class="line">    <span class="keywordflow">if</span> ( fps.parray[fpi_gainset].fpflag &amp; <a class="code" href="function__parameters_8h.html#a496c2855c8e3ea3e4e885934050243bf">FPFLAG_ONOFF</a> )  <span class="comment">// ON state</span></div><div class="line">    {</div><div class="line">        fps.parray[fpi_gain].fpflag |= <a class="code" href="function__parameters_8h.html#a667307630284d2f4ba8daea9e890b32f">FPFLAG_WRITERUN</a>;</div><div class="line">        fps.parray[fpi_gain].fpflag |= <a class="code" href="function__parameters_8h.html#a8302dd42179b2570a54a96cb53d5807a">FPFLAG_USED</a>;</div><div class="line">        fps.parray[fpi_gain].fpflag |= <a class="code" href="function__parameters_8h.html#a98d9a98c40419181f0d872a5136e7cf5">FPFLAG_VISIBLE</a>;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="comment">// OFF state</span></div><div class="line">    {</div><div class="line"></div><div class="line">        fps.parray[fpi_gain].fpflag &amp;= ~<a class="code" href="function__parameters_8h.html#a667307630284d2f4ba8daea9e890b32f">FPFLAG_WRITERUN</a>;</div><div class="line">        fps.parray[fpi_gain].fpflag &amp;= ~<a class="code" href="function__parameters_8h.html#a8302dd42179b2570a54a96cb53d5807a">FPFLAG_USED</a>;</div><div class="line">        fps.parray[fpi_gain].fpflag &amp;= ~<a class="code" href="function__parameters_8h.html#a98d9a98c40419181f0d872a5136e7cf5">FPFLAG_VISIBLE</a>;</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// ==============================================</span></div><div class="line">    <span class="comment">// ======== STOP FPS CONF LOOP ==================</span></div><div class="line">    <span class="comment">// ==============================================</span></div><div class="line">    <a class="code" href="group__fpsmacro.html#gaf877980990542985f9d4f97422865ede">FPS_CONFLOOP_END</a>  <span class="comment">// macro in function_parameter.h</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="CLIcore_8h.html#a9d37d43ac2717b06ef7120784465e56f">RETURN_SUCCESS</a>;</div><div class="line">}</div></div><!-- fragment --><hr/>
<h1><a class="anchor" id="page_FunctionParameterStructure_WritingRUNfunc"></a>
6. Writing RUN function (in source .c file)</h1>
<p>The RUN function will connect to the FPS and execute the run loop.</p>
<h2><a class="anchor" id="page_FunctionParameterStructure_WritingRUNfunc_simple"></a>
6.1. A simple _RUN example</h2>
<div class="fragment"><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// run loop process</span></div><div class="line"><span class="comment">//</span></div><div class="line"><a class="code" href="AOloopControl__IOtools_8h.html#a46a037236862ac1a534efbe605c10f42">errno_t</a> ExampleFunction_RUN(</div><div class="line">)</div><div class="line">{</div><div class="line">    <span class="comment">// ===========================</span></div><div class="line">    <span class="comment">// CONNECT TO FPS</span></div><div class="line">    <span class="comment">// ===========================</span></div><div class="line">    <a class="code" href="group__fpsmacro.html#gac759a6212d458404869a2ab872dcddfd">FPS_CONNECT</a>(<a class="code" href="AOloopControl__predfilter__onoff_8c.html#a9842752e03b4de9b4593f1a3b34364ab">data</a>.<a class="code" href="structDATA.html#a96e498dc9093cb773f2717d14d899de8">FPS_name</a>, <a class="code" href="function__parameters_8h.html#a4affa4e96188bf9d4973cb0138179c31">FPSCONNECT_RUN</a> );</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// ===============================</span></div><div class="line">    <span class="comment">// GET FUNCTION PARAMETER VALUES</span></div><div class="line">    <span class="comment">// ===============================</span></div><div class="line"></div><div class="line">    <span class="comment">// parameters are addressed by their tag name</span></div><div class="line"></div><div class="line">    <span class="comment">// These parameters are read once, before running the loop</span></div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="keywordtype">int</span> param01 = <a class="code" href="function__parameters_8c.html#ac664c552c487df9c6dc95962d147360a">functionparameter_GetParamValue_INT64</a>(&amp;fps, <span class="stringliteral">&quot;.param01&quot;</span>);</div><div class="line">    <span class="keywordtype">int</span> param02 = <a class="code" href="function__parameters_8c.html#ac664c552c487df9c6dc95962d147360a">functionparameter_GetParamValue_INT64</a>(&amp;fps, <span class="stringliteral">&quot;.param02&quot;</span>);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// This parameter is a ON / OFF toggle</span></div><div class="line">    <span class="keywordtype">int</span> gainwrite = <a class="code" href="function__parameters_8c.html#ab420fce8a88853d3ead7bd0dc93936db">functionparameter_GetParamValue_ONOFF</a>(&amp;fps, <span class="stringliteral">&quot;.option.gainwrite&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">// This parameter value will be tracked during loop run, so we create a pointer for it</span></div><div class="line">    <span class="comment">// The corresponding function is functionparameter_GetParamPtr_&lt;TYPE&gt;</span></div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="keywordtype">float</span> *gain = <a class="code" href="function__parameters_8c.html#a1799956afc859c9f0dd95b1b02868c7b">functionparameter_GetParamPtr_FLOAT32</a>(&amp;fps, <span class="stringliteral">&quot;.status.loopcnt&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordtype">char</span> imsname[<a class="code" href="function__parameters_8h.html#a0635c9ae530d4492b63534bf850945d0">FUNCTION_PARAMETER_STRMAXLEN</a>];</div><div class="line">    strncpy(imsname, <a class="code" href="function__parameters_8c.html#ae2badef26a1d964c24ee539fbfcfa6d5">functionparameter_GetParamPtr_STRING</a>(&amp;fps, <span class="stringliteral">&quot;.option.imname&quot;</span>), <a class="code" href="function__parameters_8h.html#a0635c9ae530d4492b63534bf850945d0">FUNCTION_PARAMETER_STRMAXLEN</a>);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// connect to WFS image</span></div><div class="line">        <span class="keywordtype">long</span> IDim = <a class="code" href="COREMOD__memory_8c.html#a427e2829bcc5b38b58c6361b5e6245f0">read_sharedmem_image</a>(imsname);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// ===============================</span></div><div class="line">    <span class="comment">// RUN LOOP</span></div><div class="line">    <span class="comment">// ===============================</span></div><div class="line"></div><div class="line">    <span class="keywordtype">int</span> loopOK = 1;</div><div class="line">    <span class="keywordflow">while</span>( loopOK == 1 )</div><div class="line">    {</div><div class="line">        <span class="comment">// here we compute what we need...</span></div><div class="line">        <span class="comment">//</span></div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// Note that some mechanism is required to set loopOK to 0 when MyFunction_Stop() is called</span></div><div class="line">        <span class="comment">// This can use a separate shared memory path</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="function__parameters_8c.html#a0374459635182c10735f6f63c92b2345">function_parameter_RUNexit</a>( &amp;fps );</div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="CLIcore_8h.html#a9d37d43ac2717b06ef7120784465e56f">RETURN_SUCCESS</a>;</div><div class="line">}</div></div><!-- fragment --><h2>6.2. Non-FPS fallback function</h2>
<div class="fragment"><div class="line"><a class="code" href="AOloopControl__IOtools_8h.html#a46a037236862ac1a534efbe605c10f42">errno_t</a> ExampleFunction(</div><div class="line">    <span class="keywordtype">long</span> arg0num, </div><div class="line">    <span class="keywordtype">long</span> arg1num, </div><div class="line">    <span class="keywordtype">long</span> arg2num, </div><div class="line">    <span class="keywordtype">long</span> arg3num</div><div class="line">) {</div><div class="line">    <span class="keywordtype">char</span> fpsname[200];</div><div class="line"></div><div class="line">    <span class="keywordtype">long</span> pindex = (long) getpid();  <span class="comment">// index used to differentiate multiple calls to function</span></div><div class="line">    <span class="comment">// if we don&#39;t have anything more informative, we use PID</span></div><div class="line"></div><div class="line">    <a class="code" href="structFUNCTION__PARAMETER__STRUCT.html">FUNCTION_PARAMETER_STRUCT</a> fps;</div><div class="line"></div><div class="line">    <span class="comment">// create FPS</span></div><div class="line">    sprintf(<a class="code" href="AOloopControl__predfilter__onoff_8c.html#a9842752e03b4de9b4593f1a3b34364ab">data</a>.<a class="code" href="structDATA.html#a96e498dc9093cb773f2717d14d899de8">FPS_name</a>, <span class="stringliteral">&quot;exfunc-%06ld&quot;</span>, pindex);</div><div class="line">    <a class="code" href="AOloopControl__predfilter__onoff_8c.html#a9842752e03b4de9b4593f1a3b34364ab">data</a>.FPS_CMDMODE = <a class="code" href="function__parameters_8h.html#a8af8eddc8406bb2da546d0fdf6d8def3">FPSCMDCODE_FPSINIT</a>;</div><div class="line">    ExampleFunction_FPCONF();</div><div class="line"></div><div class="line">    <a class="code" href="function__parameters_8c.html#a4eb2b4db6e7d81a93556e26a0a1df6cc">function_parameter_struct_connect</a>(<a class="code" href="AOloopControl__predfilter__onoff_8c.html#a9842752e03b4de9b4593f1a3b34364ab">data</a>.<a class="code" href="structDATA.html#a96e498dc9093cb773f2717d14d899de8">FPS_name</a>, &amp;fps, <a class="code" href="function__parameters_8h.html#ad4a8dd96076fec21220e894df996f728">FPSCONNECT_SIMPLE</a>);</div><div class="line"></div><div class="line">    <a class="code" href="function__parameters_8c.html#a62575ed1491ce26d77e7c87b1737bdd0">functionparameter_SetParamValue_INT64</a>(&amp;fps, <span class="stringliteral">&quot;.arg0&quot;</span>, arg0);</div><div class="line">    <a class="code" href="function__parameters_8c.html#a62575ed1491ce26d77e7c87b1737bdd0">functionparameter_SetParamValue_INT64</a>(&amp;fps, <span class="stringliteral">&quot;.arg1&quot;</span>, arg1);</div><div class="line">    <a class="code" href="function__parameters_8c.html#a62575ed1491ce26d77e7c87b1737bdd0">functionparameter_SetParamValue_INT64</a>(&amp;fps, <span class="stringliteral">&quot;.arg2&quot;</span>, arg2);</div><div class="line">    <a class="code" href="function__parameters_8c.html#a62575ed1491ce26d77e7c87b1737bdd0">functionparameter_SetParamValue_INT64</a>(&amp;fps, <span class="stringliteral">&quot;.arg3&quot;</span>, arg3);</div><div class="line"></div><div class="line">    <a class="code" href="function__parameters_8c.html#aed1068418a14a370741809bf76bab69b">function_parameter_struct_disconnect</a>(&amp;fps);</div><div class="line"></div><div class="line">    ExampleFunction_RUN();</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="CLIcore_8h.html#a9d37d43ac2717b06ef7120784465e56f">RETURN_SUCCESS</a>;</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="page_FunctionParameterStructure_WritingRUNfunc_processinfo"></a>
6.3. RUN function with FPS and processinfo</h2>
<p>In this example, the loop process supports both FPS and processinfo. This is the preferred way to code a loop process.</p>
<p>The example also shows using FPS to set the process realtime priority.</p>
<div class="fragment"><div class="line"><span class="comment">/* \@brief Loop process code example</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * ## Purpose</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This example demonstrates use of processinfo and fps structures.\n</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * All function parameters are held inside the function parameter structure (FPS).\n</span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * ## Details</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><a class="code" href="AOloopControl__IOtools_8h.html#a46a037236862ac1a534efbe605c10f42">errno_t</a> MyFunction_RUN(</div><div class="line">)</div><div class="line">{</div><div class="line">    <span class="comment">// ===========================</span></div><div class="line">    <span class="comment">// ### Connect to FPS </span></div><div class="line">    <span class="comment">// ===========================</span></div><div class="line">    <a class="code" href="group__fpsmacro.html#gac759a6212d458404869a2ab872dcddfd">FPS_CONNECT</a>( <a class="code" href="AOloopControl__predfilter__onoff_8c.html#a9842752e03b4de9b4593f1a3b34364ab">data</a>.<a class="code" href="structDATA.html#a96e498dc9093cb773f2717d14d899de8">FPS_name</a>, <a class="code" href="function__parameters_8h.html#a4affa4e96188bf9d4973cb0138179c31">FPSCONNECT_RUN</a> );</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// ===================================  </span></div><div class="line">    <span class="comment">// ### GET FUNCTION PARAMETER VALUES</span></div><div class="line">    <span class="comment">// ===================================</span></div><div class="line">    <span class="comment">// parameters are addressed by their tag name</span></div><div class="line"></div><div class="line">    <span class="comment">// These parameters are read once, before running the loop</span></div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="keywordtype">int</span> param01 = <a class="code" href="function__parameters_8c.html#ac664c552c487df9c6dc95962d147360a">functionparameter_GetParamValue_INT64</a>(&amp;fps, <span class="stringliteral">&quot;.param01&quot;</span>);</div><div class="line">    <span class="keywordtype">int</span> param02 = <a class="code" href="function__parameters_8c.html#ac664c552c487df9c6dc95962d147360a">functionparameter_GetParamValue_INT64</a>(&amp;fps, <span class="stringliteral">&quot;.param02&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordtype">char</span> nameim[<a class="code" href="function__parameters_8h.html#a0635c9ae530d4492b63534bf850945d0">FUNCTION_PARAMETER_STRMAXLEN</a>+1];</div><div class="line">    strncpy(nameim, <a class="code" href="function__parameters_8c.html#ae2badef26a1d964c24ee539fbfcfa6d5">functionparameter_GetParamPtr_STRING</a>(&amp;fps, <span class="stringliteral">&quot;.option.nameim&quot;</span>), <a class="code" href="function__parameters_8h.html#a0635c9ae530d4492b63534bf850945d0">FUNCTION_PARAMETER_STRMAXLEN</a>);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// This parameter value will be tracked during loop run, so we create a pointer for it</span></div><div class="line">    <span class="comment">// The corresponding function is functionparameter_GetParamPtr_&lt;TYPE&gt;</span></div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="keywordtype">float</span> *gain = <a class="code" href="function__parameters_8c.html#a1799956afc859c9f0dd95b1b02868c7b">functionparameter_GetParamPtr_FLOAT32</a>(&amp;fps, <span class="stringliteral">&quot;.ctrl.gain&quot;</span>);</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// ===========================</span></div><div class="line">    <span class="comment">// ### processinfo support </span></div><div class="line">    <span class="comment">// ===========================</span></div><div class="line"></div><div class="line">    <a class="code" href="structPROCESSINFO.html">PROCESSINFO</a> *processinfo;</div><div class="line"></div><div class="line">    processinfo = <a class="code" href="processtools_8c.html#a9912007733ec7c0b2f4f18a2763fe12b">processinfo_setup</a>(</div><div class="line">        <a class="code" href="AOloopControl__predfilter__onoff_8c.html#a9842752e03b4de9b4593f1a3b34364ab">data</a>.<a class="code" href="structDATA.html#a96e498dc9093cb773f2717d14d899de8">FPS_name</a>,               <span class="comment">// re-use fpsname as processinfo name</span></div><div class="line">        <span class="stringliteral">&quot;computes something&quot;</span>,    <span class="comment">// description</span></div><div class="line">        <span class="stringliteral">&quot;add image1 to image2&quot;</span>,  <span class="comment">// message on startup</span></div><div class="line">        __FUNCTION__, __FILE__, __LINE__</div><div class="line">        );</div><div class="line"></div><div class="line">    <span class="comment">// OPTIONAL SETTINGS</span></div><div class="line">    processinfo-&gt;<a class="code" href="structPROCESSINFO.html#aba1c55f3b8cd222f1e6bc6ba79d9f983">MeasureTiming</a> = 1; <span class="comment">// Measure timing </span></div><div class="line">    processinfo-&gt;<a class="code" href="structPROCESSINFO.html#a547f4806f0bcb3da0ca25727e9d824de">RT_priority</a> = 20;  <span class="comment">// RT_priority, 0-99. Larger number = higher priority. If &lt;0, ignore</span></div><div class="line">    processinfo-&gt;<a class="code" href="structPROCESSINFO.html#ad003eb4e1cabb0fc41becc8321daa0f4">loopcntMax</a> = 1000; <span class="comment">// max number of iterations. -1 if infinite</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="keywordtype">int</span> loopOK = 1;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// =============================================</span></div><div class="line">    <span class="comment">// OPTIONAL: TESTING CONDITION FOR LOOP ENTRY</span></div><div class="line">    <span class="comment">// =============================================</span></div><div class="line">    <span class="comment">// Pre-loop testing, anything that would prevent loop from starting should issue message</span></div><div class="line">    <span class="keywordtype">int</span> loopOK = 1;</div><div class="line">    <span class="keywordflow">if</span>(.... error condition ....)</div><div class="line">    {</div><div class="line">        <span class="comment">// exit function with ERROR status</span></div><div class="line">        <a class="code" href="processtools_8c.html#ac299545ba314c71a211102ef2b08ee44">processinfo_error</a>(processinfo, <span class="stringliteral">&quot;ERROR: no WFS reference&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> <a class="code" href="CLIcore_8h.html#a2c984349b6e2ee2e658b9cf9ef2aa2fb">RETURN_FAILURE</a>;</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// ===========================</span></div><div class="line">    <span class="comment">// ### Start loop</span></div><div class="line">    <span class="comment">// ===========================</span></div><div class="line"></div><div class="line"></div><div class="line">    <a class="code" href="processtools_8c.html#a7c1684f725dca2f03649af3a0de4dfe6">processinfo_loopstart</a>(processinfo); <span class="comment">// Notify processinfo that we are entering loop</span></div><div class="line"></div><div class="line">    <span class="keywordflow">while</span>(loopOK==1)</div><div class="line">    {</div><div class="line">        loopOK = <a class="code" href="processtools_8c.html#ad4b2e6d100dbb484529e7b8f6ce29f74">processinfo_loopstep</a>(processinfo);</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">//</span></div><div class="line">        <span class="comment">// Semaphore wait goes here  </span></div><div class="line">        <span class="comment">// computation starts here</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">        <a class="code" href="processtools_8c.html#ac7362657ee39e9d45147eaf279ed1c98">processinfo_exec_start</a>(processinfo);    </div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="processtools_8c.html#a29f5a97a4a7f9cc283111ab5bbf00101">processinfo_compute_status</a>(processinfo)==1)</div><div class="line">        {</div><div class="line">            <span class="comment">//</span></div><div class="line">            <span class="comment">// computation ....</span></div><div class="line">            <span class="comment">//</span></div><div class="line">        }</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// Post semaphore(s) and counter(s) </span></div><div class="line">        <span class="comment">// computation done</span></div><div class="line"></div><div class="line">        <span class="comment">// process signals, increment loop counter</span></div><div class="line">        <a class="code" href="processtools_8c.html#a4fc8ad2d87c7a9e1b36c8bb929f0cd10">processinfo_exec_end</a>(processinfo);</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// OPTIONAL: MESSAGE WHILE LOOP RUNNING</span></div><div class="line">        <a class="code" href="processtools_8c.html#a8b65e8c0f0375faff7df95846e407a60">processinfo_WriteMessage</a>(processinfo, <span class="stringliteral">&quot;loop running fine&quot;</span>);     </div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// ==================================</span></div><div class="line">    <span class="comment">// ### ENDING LOOP</span></div><div class="line">    <span class="comment">// ==================================</span></div><div class="line"></div><div class="line">     <a class="code" href="processtools_8c.html#af888f7a68f7df49ce295a2920a82b68e">processinfo_cleanExit</a>(processinfo);</div><div class="line">    <a class="code" href="function__parameters_8c.html#a0374459635182c10735f6f63c92b2345">function_parameter_RUNexit</a>( &amp;fps  );</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="CLIcore_8h.html#a9d37d43ac2717b06ef7120784465e56f">RETURN_SUCCESS</a>;</div><div class="line">}</div></div><!-- fragment --><hr/>
 </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="page_cacao_topmenu.html">Subpages</a></li><li class="navelem"><a class="el" href="page_coding_standards.html">Coding Standards</a></li>
    <li class="footer">Generated on Thu Apr 2 2020 16:50:24 for cacao by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
