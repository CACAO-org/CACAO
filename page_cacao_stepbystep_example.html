<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>cacao: STEP-BY-STEP EXAMPLE</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="cacao-logo-small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">cacao
   &#160;<span id="projectnumber">Release 0.1.03-dev</span>
   </div>
   <div id="projectbrief">Compute And Control For Adaptive Optics</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('page_cacao_stepbystep_example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">STEP-BY-STEP EXAMPLE </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>File</p>
<h2>1. Important tips before getting started</h2>
<h3>1.1. Inspecting and viewing streams</h3>
<p>cacao uses shared memory streams to store real-time data and communicate through processes. At any time, you can inspect the content of a stream by launching: </p><pre class="fragment">shmimmon &lt;streamname&gt;
</pre><p>You can also view the stream : </p><pre class="fragment">shmimview /tmp/&lt;streamname&gt;.im.shm
</pre><p>As you go through the example below, you will make frequent use of these commands to check status.</p>
<h3>1.2. Checking processes</h3>
<p>Processes run in tmux sessions. To list all tmux sessions: </p><pre class="fragment">tmux ls
</pre><p>To enter a tmux session </p><pre class="fragment">tmux a -t &lt;sessionname&gt;
</pre><p>To detach from the session, type CTRL-B and then D. Do not type CTRL-C or exit, this will kill the process.</p>
<hr/>
<h2>2. Starting the linear hardware simulator</h2>
<p>In this example, we will set a hardware simulator of the AO system. The simulator takes DM shapes and computes corresponding WFS images, so it replaces the actual hardware. cacao will then connect to this simulator, as if it was connected to actual hardware.</p>
<p><b>STEP 1</b>: Create a working directory <code>&lt;workdir&gt;</code></p>
<p><b>STEP 2</b>: Install cacao scripts into <code>&lt;workdir&gt;</code>: </p><pre class="fragment">cd &lt;srcdir&gt;/src/AOloopControl/scripts
./syncscripts -e &lt;workdir&gt;
cd &lt;workdir&gt;
./syncscripts
</pre><p>Note: on scexao computer, &lt;srcdir&gt; = /home/scexao/src/cacao</p>
<p><b>STEP 3</b>: Download a calibration, consisting of zonal response matrix and a WFS reference. Place the file in a new directory <code>&lt;workdir&gt;/simLHS</code></p>
<p>Calibration files :</p><ul>
<li>WFS reference: <a href="https://drive.google.com/file/d/1LnYfc8mKYyERc9cNMCiVTvwX-3wRsdFU">https://drive.google.com/file/d/1LnYfc8mKYyERc9cNMCiVTvwX-3wRsdFU</a></li>
<li>WFS zonal response: <a href="https://drive.google.com/open?id=1rBkLllb6rR0z-D9YfysHedAWFE_Umwil">https://drive.google.com/open?id=1rBkLllb6rR0z-D9YfysHedAWFE_Umwil</a></li>
</ul>
<p>On scexao computer, files are in /home/scexao/conf directory: </p><pre class="fragment">cp /home/scexao/conf/cacao/simLHS/LHS_zrespM_2018-01-25_05:09:52.fits.gz &lt;workdir&gt;/simLHS ./simLHS/
cp /home/scexao/conf/cacao/simLHS/LHS_wfsref0_2018-01-25_05:09:52.fits.gz &lt;workdir&gt;/simLHS ./simLHS/
</pre><p><b>STEP 4</b>: Launch aolconf, loop number 5, loop name simtest: </p><pre class="fragment">./aolconf -L 5 -N simtest
</pre><p>Note that you subsequent calls to aolconf should then be without the -L and -N options.</p>
<p><b>STEP 5</b>: Set DM :</p><ul>
<li>set DM index to 01</li>
<li>set size to match the calibration. <code>dmxs</code> and <code>dmys</code> GUI top menu. Both should be set to 50.</li>
</ul>
<p><b>STEP 6</b>: Autoconfigure DM: <code>nolink</code> in GUI top menu. This will configure the DM in its simplest setting (no link to other loops).</p>
<p><b>STEP 7</b>: Turn off dmvolt, as we are not connected to actual hardware: <code>dmvolt0</code> in GUI top menu.</p>
<p><b>STEP 8</b>: Set DM averaging mode to 2: <code>dmcombam</code> in GUI top menu.</p>
<p><b>STEP 9</b>: Start DMcomb. <code>initDM</code> in GUI top menu. This will start DM channels and the process that monitors them and adds them to a single total displacement channel.</p>
<p><b>STEP 10</b>: Load all memory. <code>M</code> in GUI top menu</p>
<p><b>STEP 11</b>: Link LHS files. From main menu, go to "Test mode" submenu. Select <code>zrespMlinsim</code> and <code>wfsref0linsim</code>.</p>
<p><b>STEP 12</b>: Start the LHS process.<br />
Select GPU device and start LHS process.<br />
To check that output WFS image is updating: </p><pre class="fragment">shmimmon aol5_linsimWFS
</pre><p>You should see counter cnt0 increment and the corresponsing frame rate should show the update rate.</p>
<p>To check GPU useage: </p><pre class="fragment">nvidia-smi
</pre><p>You should see that the GPU selected for linear simulation is somewhat busy.</p>
<hr/>
<h2>3. Acquiring calibration, compute control matrix</h2>
<p>Under configuration GUI menu (Configure/link AO loop):</p>
<ul>
<li>Measure hardware timing: <code>mlat</code>. You will bye asked how many frames to use for sampling. Keep the default value (100). This command will update timing parameters (measured loop frequ, hardware latency).</li>
<li>set Hadamard mode to ON: <code>Hon</code></li>
<li>set modal RM to ON: <code>RMMon</code></li>
<li>set modal RM amplitude to 0.05um: <code>rmMamp</code></li>
<li>set modal RM cycle per aperture to 3: <code>rmMcpa</code></li>
<li>set RM excluded frames to 1: <code>rmexfr</code></li>
<li>Acquire automatic calibration: <code>nAUTOc</code></li>
</ul>
<p>Under control matrix GUI menu :</p>
<ul>
<li>Select maximum control spatial frequency: <code>modeCPA</code></li>
<li>Create modes and control matrix: <code>mkModes0</code></li>
<li>update configuration: <code>confUp</code></li>
<li>load shared memory: <code>SMload</code></li>
</ul>
<p>Load and manage configuration :</p>
<ul>
<li>load configuration</li>
<li>save configuration</li>
</ul>
<hr/>
<h2>4. Running the loop</h2>
<p><b>OPTIONAL</b>: Start artificial turbulence.</p>
<h3>4.1. Loop configuration</h3>
<p>Go to Loop Control screen.</p>
<ul>
<li>Select GPU0 set.</li>
<li>Turn off GPU1 set.</li>
<li>Select GPU for DM filtered write</li>
<li>Set GPUall to OFF.</li>
<li>Set CMMODE to OFF.</li>
<li>Toggle all processes to ON.</li>
<li>Turn on DM filtered write.</li>
</ul>
<h3>4.2. Turning loop ON / OFF</h3>
<ul>
<li>Start AO processes, wait a few seconds</li>
<li>Turn ON DM filtered write</li>
<li>Turn ON WFS computation</li>
<li>Start/stop AO loop as needed</li>
</ul>
<h3>4.3. Checking the loop performance</h3>
<p>You can view the following streams:</p>
<ul>
<li>aol5_dmC</li>
<li>aol5_wfsim </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="page_cacao_topmenu.html">Subpages</a></li><li class="navelem"><a class="el" href="page_cacao_top_guide.html">Configuring and Running cacao</a></li>
    <li class="footer">Generated on Thu Apr 2 2020 16:50:24 for cacao by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
